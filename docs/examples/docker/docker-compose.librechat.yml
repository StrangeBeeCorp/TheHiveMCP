services:
  mongodb:
    image: mongo:6.0
    restart: always
    volumes:
      - mongodb_data:/data/db

  meilisearch:
    image: getmeili/meilisearch:v1.11
    restart: always
    volumes:
      - meilisearch_data:/meili_data
    environment:
      - MEILI_NO_ANALYTICS=true

  thehivemcp:
    image: ghcr.io/strangebee/thehivemcp/thehivemcp:v0.2.3
    restart: always
    environment:
      - PERMISSIONS_CONFIG=admin
      - MCP_BIND_HOST=0.0.0.0
      - MCP_PORT=8082
      # Use Anthropic's OpenAI-compatible endpoint for fallback LLM
      - OPENAI_API_KEY=${ANTHROPIC_API_KEY}
      - OPENAI_BASE_URL=https://api.anthropic.com/v1
      - OPENAI_MODEL=claude-haiku-4-5

  api:
    image: ghcr.io/strangebee/librechat-thehivemcp:latest
    restart: always
    ports:
      - "3080:3080"
    depends_on:
      - mongodb
      - meilisearch
      - thehivemcp
    environment:
      - HOST=0.0.0.0
      - MONGO_URI=mongodb://mongodb:27017/LibreChat
      - MEILI_HOST=http://meilisearch:7700
      - ENDPOINTS=anthropic
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - CREDS_KEY=f34be427ebb29de8d88c107a71546019685ed8b241d8f2ed00c3df97ad2566f0
      - CREDS_IV=e2341419ec3dd3d19b13a1a87fafcbfb
      - JWT_SECRET=a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4
      - JWT_REFRESH_SECRET=z9y8x7w6v5u4t3s2r1q0p9o8n7m6l5k4j3i2h1g0f9e8d7c6
      - ALLOW_REGISTRATION=true
      - ALLOW_EMAIL_LOGIN=true
    volumes:
      - uploads:/app/uploads

volumes:
  mongodb_data:
  meilisearch_data:
  uploads:
